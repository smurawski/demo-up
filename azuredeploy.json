{"$schema":"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","outputs":{},"parameters":{"FQDNPrefix":{"type":"string"}},"resources":[{"apiVersion":"2018-11-30","location":"[resourceGroup().location]","name":"bootstrap-creds","type":"Microsoft.ManagedIdentity/userAssignedIdentities"},{"apiVersion":"2018-09-01-preview","dependsOn":["[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('identityName'))]"],"name":"[variables('bootstrapRoleAssignmentId')]","properties":{"principalId":"[reference(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('identityName')), '2015-08-31-preview').principalId]","principalType":"ServicePrincipal","roleDefinitionId":"[variables('contributorRoleDefinitionId')]","scope":"[resourceGroup().id]"},"type":"Microsoft.Authorization/roleAssignments"},{"apiVersion":"2018-07-01","kind":"StorageV2","location":"[resourceGroup().location]","name":"[variables('storageAccountName')]","properties":{"accessTier":"Hot"},"resources":[{"apiVersion":"2018-07-01","dependsOn":["[variables('storageAccountName')]"],"name":"[concat('default/', variables('containerName'))]","type":"blobServices/containers"}],"sku":{"name":"Standard_LRS","tier":"Standard"},"type":"Microsoft.Storage/storageAccounts"},{"apiVersion":"2018-10-01","dependsOn":["[resourceId('Microsoft.Authorization/roleAssignments', variables('bootstrapRoleAssignmentId'))]","[variables('storageAccountName')]"],"identity":{"type":"UserAssigned","userAssignedIdentities":{"[resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('identityName'))]":{}}},"location":"[resourceGroup().location]","name":"[variables('aciName')]","properties":{"containers":[{"name":"azure-cli","properties":{"command":["/bin/sh","-c","sh /boot-strap.sh"],"environmentVariables":[{"name":"RESOURCE_GROUP_NAME","secureValue":"[variables('rgname')]"},{"name":"BASE_NAME","secureValue":"[parameters('FQDNPrefix')]"},{"name":"AZURE_STORAGE_ACCOUNT","secureValue":"[variables('storageAccountName')]"},{"name":"AZURE_STORAGE_KEY","secureValue":"[listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName')), providers('Microsoft.Storage', 'storageAccounts').apiVersions[0]).keys[0].value]"},{"name":"MANAGED_IDENTITY","secureValue":"[concat(resourceId('Microsoft.ManagedIdentity/userAssignedIdentities', variables('identityName')))]"},{"name":"SESSION_CODE","secureValue":"[variables('sessionCode')]"},{"name":"SOURCE_REPOSITORY","secureValue":"[variables('sourceRepo')]"},{"name":"ENTRYPOINT","secureValue":"[variables('entrypoint')]"}],"image":"[variables('deploymentImage')]","resources":{"requests":{"cpu":1,"memoryInGB":1}}}}],"osType":"Linux","restartPolicy":"OnFailure"},"type":"Microsoft.ContainerInstance/containerGroups"}],"variables":{"aciName":"[concat(parameters('FQDNPrefix'), '-bootstrap')]","bootstrapRoleAssignmentId":"[guid(concat(resourceGroup().id, 'contributor'))]","containerName":"logs","contributorRoleDefinitionId":"[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Authorization/roleDefinitions/', 'b24988ac-6180-42a0-ab88-20f7382dd24c')]","deploymentImage":"neilpeterson/itt-bootstrap","entrypoint":"/MIG10/deployment-artifacts/deployment/deploy.sh","identityName":"bootstrap-creds","rgname":"[resourceGroup().name]","sessionCode":"DEV10","sourceRepo":"https://github.com/neilpeterson/ignite-tour-fy20.git","storageAccountName":"[toLower(uniqueString(resourceGroup().id))]"}}